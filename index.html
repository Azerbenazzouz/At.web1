<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>At 1</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css" integrity="sha384-rbsA2VBKQhggwzxH7pPCaAqO46MgnOM80zW1RWuH61DGLwZJEdK2Kadq2F9CUG65" crossorigin="anonymous">
</head>
<body>
    <button class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#exampleModal" id="ajout">ajouter</button>
    <table class="table table-bordered border-primary">
        <thead>
            <tr>
                <th scope="col">id</th>
                <th scope="col">titre</th>
                <th scope="col">auteur</th>
                <th scope="col">prix</th>
                <th scope="col">editer</th>
                <th scope="col">supprimer</th>
            </tr>
          </thead>
          <tbody>

          </tbody>
      </table>
        <!-- Modal -->
        <div class="modal fade" id="exampleModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
            <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                <h1 class="modal-title fs-5" id="modal-title">Ajouter</h1>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <div class="mb-3">
                        <label for="titleM" class="form-label">Title</label>
                        <input type="text" class="form-control" id="titleM" value="">
                    </div>
                    <div class="mb-3">
                        <label for="auteurM" class="form-label">Auteur</label>
                        <input type="text" class="form-control" id="auteurM" value="">
                    </div>
                    <div class="mb-3">
                        <label for="prixM" class="form-label">Prix (tnd)</label>
                        <input type="text" class="form-control" id="prixM" value="0">
                    </div>
                </div>
                <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                <button type="button" class="btn btn-primary" data-bs-dismiss="modal" id="changeBtnM">Save changes</button>
                <button type="button" class="btn btn-warning" data-bs-dismiss="modal" id="ajoutBtnM">Ajouter</button>
                </div>
            </div>
            </div>
        </div>

        
    <script>
        let books = [
            {
                id: 1,
                titre: "Le seigneur des anneaux",
                auteur: "J.R.R. Tolkien",
                prix: 20
            },
            {
                id: 2,
                titre: "Harry Potter",
                auteur: "J.K. Rowling",
                prix: 25
            },
            {
                id: 3,
                titre: "Le petit prince",
                auteur: "Antoine de Saint-Exupéry",
                prix: 15
            },
            {
                id: 4,
                titre: "Le seigneur des anneaux",
                auteur: "J.R.R. Tolkien",
                prix: 20
            },
            {
                id: 5,
                titre: "Harry Potter",
                auteur: "J.K. Rowling",
                prix: 25
            },
            {
                id: 6,
                titre: "Le petit prince",
                auteur: "Antoine de Saint-Exupéry",
                prix: 15
            },
            {
                id: 7,
                titre: "Le seigneur des anneaux",
                auteur: "J.R.R. Tolkien",
                prix: 20
            },
            {
                id: 8,
                titre: "Harry Potter",
                auteur: "J.K. Rowling",
                prix: 25
            },
            {
                id: 9,
                titre: "Le petit prince",
                auteur: "Antoine de Saint-Exupéry",
                prix: 15
            },
            {
                id: 10,
                titre: "Le seigneur des anneaux",
                auteur: "J.R.R. Tolkien",
                prix: 20
            },
            {
                id: 11,
                titre: "Harry Potter",
                auteur: "J.K. Rowling",
                prix: 25
            },
            {
                id: 12,
                titre: "Le petit prince",
                auteur: "Antoine de Saint-Exupéry",
                prix: 15
            },
            {
                id: 13,
                titre: "Le seigneur des anneaux",
                auteur: "J.R.R. Tolkien",
                prix: 20
            },
            {
                id: 14,
                titre: "Harry Potter",
                auteur: "J.K. Rowling",
                prix: 25
            },
            {
                id: 15,
                titre: "Le petit prince",
                auteur: "Antoine de Saint-Exupéry",
                prix: 15
            },
            {
                id: 16,
                titre: "Le seigneur des anneaux",
                auteur: "J.R.R. Tolkien",
                prix: 20
            },
            {
                id: 17,
                titre: "Harry Potter",
                auteur: "J.K. Rowling",
                prix: 25
            },
        ]
        const showBooks = () =>{
            let tbody = document.querySelector("tbody");
            books.forEach(book => {
                let tr = document.createElement("tr");
                let thId = document.createElement("th");

                thId.setAttribute("scope","row");
                thId.setAttribute("name","id-"+book.id);

                let tdTitre = document.createElement("td");
                let tdAuteur = document.createElement("td");
                let tdPrix = document.createElement("td");
                let tdEditer = document.createElement("td");
                let btnEditer = document.createElement("button");
                let tdSupprimer = document.createElement("td");
                let BtnSupprimer = document.createElement("button");


                thId.innerText = book.id;
                tdTitre.innerText = book.titre;
                tdAuteur.innerText = book.auteur;
                tdPrix.innerText = book.prix+" TND";
                btnEditer.setAttribute("class","btn btn-warning");
                btnEditer.setAttribute("data-bs-toggle","modal");
                btnEditer.setAttribute("data-bs-target","#exampleModal");
                btnEditer.setAttribute("name","editer");
                btnEditer.setAttribute("id",book.id);
                btnEditer.innerText = "Editer";
                btnEditer.addEventListener("click",()=>{
                    let id = btnEditer.getAttribute("id");
                    let book = books.find(book => book.id == id);
                    let titleM = document.querySelector("#titleM");
                    let titleModel = document.querySelector("#modal-title");
                    let auteurM = document.querySelector("#auteurM");
                    let prixM = document.querySelector("#prixM");

                    titleM.value = book.titre;
                    titleModel.innerText = book.titre;
                    auteurM.value = book.auteur;
                    prixM.value = book.prix;
                    let btnSave = document.querySelector("#changeBtnM");
                    btnSave.addEventListener("click",function(){
                        saveEdit(id,book.titre,book.auteur,book.prix);
                        console.log("save");
                    })
                    
                })
                tdEditer.appendChild(btnEditer);
                BtnSupprimer.setAttribute("class","btn btn-danger");
                BtnSupprimer.innerText = "Supprimer";
                BtnSupprimer.addEventListener("click",function(){
                    console.log("supprimer");
                    supprimer(book.id);
                })
                tdSupprimer.appendChild(BtnSupprimer);

                tr.appendChild(thId);
                tr.appendChild(tdTitre);
                tr.appendChild(tdAuteur);
                tr.appendChild(tdPrix);
                tr.appendChild(tdEditer);
                tr.appendChild(tdSupprimer);
                tr.setAttribute("id","id-"+book.id);
                tbody.appendChild(tr);

                // tdSupprimer.getElementsByTagName("button")[0].addEventListener("click",function(){
                //     supprimer(book.id);
                // })

                // let btnEditer = document.getElementsByName("editer");
                // btnEditer.forEach(btn => editBtn(btn));
            });
        }
        const saveEdit = (id,title,auteur,prix) => {
            let book = books.find(book => book.id == id);
            book.titre = title;
            book.auteur = auteur;
            book.prix = prix;
            // find the book in the table and update it
            let tr = document.getElementById("id-"+id);
            let tdTitre = tr.children[1];
            let tdAuteur = tr.children[2];
            let tdPrix = tr.children[3];
            tdTitre.innerText = title;
            tdAuteur.innerText = auteur;
            tdPrix.innerText = prix+" TND";
        }
        const supprimer = (id) => {
            let book = books.find(book => book.id == id);
            let index = books.indexOf(book);
            books.splice(index,1);
            document.getElementById("id-"+id).remove();
        }
        
        const ajout = () =>{
            let tbody = document.querySelector("tbody");
            let tr = document.createElement("tr");
            let thId = document.createElement("th");
            var id = 44;
            thId.setAttribute("scope","row");
            thId.setAttribute("name","id-"+id);

            let tdTitre = document.createElement("td");
            let tdAuteur = document.createElement("td");
            let tdPrix = document.createElement("td");
            let tdEditer = document.createElement("td");
            let btnEditer = document.createElement("button");
            let tdSupprimer = document.createElement("td");
            let BtnSupprimer = document.createElement("button");


            thId.innerText = id;
            tdTitre.innerText = document.querySelector("#titleM").value;
            tdAuteur.innerText = document.querySelector("#auteurM").value;
            tdPrix.innerText = document.querySelector("#prixM")+" TND";
            btnEditer.setAttribute("class","btn btn-warning");
            btnEditer.setAttribute("data-bs-toggle","modal");
            btnEditer.setAttribute("data-bs-target","#exampleModal");
            btnEditer.setAttribute("name","editer");
            btnEditer.setAttribute("id",id);
            btnEditer.innerText = "Editer";
            btnEditer.addEventListener("click",function(){
                    let id = btn.getAttribute("id");
                    let book = books.find(book => book.id == id);
                    let titleM = document.querySelector("#titleM");
                    let titleModel = document.querySelector("#modal-title");
                    let auteurM = document.querySelector("#auteurM");
                    let prixM = document.querySelector("#prixM");

                    titleM.value = book.titre;
                    titleModel.innerText = book.titre;
                    auteurM.value = book.auteur;
                    prixM.value = book.prix;
                    let btnSave = document.querySelector(".btn-primary");
                    btnSave.addEventListener("click",function(){
                        saveEdit(id,titleM.value,auteurM.value,prixM.value);
                    })
                    
                })
            tdEditer.appendChild(btnEditer);
            BtnSupprimer.setAttribute("class","btn btn-danger");
            BtnSupprimer.innerText = "Supprimer";
            BtnSupprimer.addEventListener("click",function(){
                console.log("supprimer");
                supprimer(id);
            })
            tdSupprimer.appendChild(BtnSupprimer);

            tr.appendChild(thId);
            tr.appendChild(tdTitre);
            tr.appendChild(tdAuteur);
            tr.appendChild(tdPrix);
            tr.appendChild(tdEditer);
            tr.appendChild(tdSupprimer);
            tr.setAttribute("id","id-"+id);
            tbody.appendChild(tr);

        }
        window.addEventListener("load",showBooks);

        const editBtn = (btn) =>{
            btn
        }
        
    </script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.min.js" integrity="sha384-cuYeSxntonz0PPNlHhBs68uyIAVpIIOZZ5JqeqvYYIcEL727kskC66kF92t6Xl2V" crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-kenU1KFdBIe4zVF0s0G1M5b4hcpxyD9F7jL+jjXkk+Q2h455rYXK/7HAuoJl+0I4" crossorigin="anonymous"></script>    
</body>
</html>